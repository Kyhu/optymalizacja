clear_all_not_bp;

path('BFGS/', path); % sciezka do BFGSa
path('line_search/', path); % sciezka do line searcha
path('quality_index/', path); % sciezka do wskaznika jakosci
path('model/', path); % sciezka do rownan stanu razem z rk4 i approkysmacja calego przebiegu
load_constants;

%% Test rk4 i appro
% t0 = 0;  
% tn = 30; % (t0, tn) - ca�kowity przedzia� czasu
% u = [1 -10 5 20 0 0; 0 1 0 -1 0 0;0 2 5 -5 2 0]; %losowe wsp�czynniki sterowania
% x0 = [0 0 0 0 0 0 0];  % punk startowy
% q = 100; % liczba punktow w podprzedziale
% figure(1);
%     
% [t,x] = appr([t0 tn], u, x0, @rhs_SRV, 100);  
% plot(t,x); 


%% Test samego line_searcha (mimum tych funkcji to 2 i 3 ale prosta nie przechodzi dokladnie przez ten punkt));
% x0 = [6 7]'; % punkt startowy
% sd = [1 1]' - x0; % kierunek poszukiwania
% T = 1; % nie uzywamy, ale bedzie potrzebne przy innych zadaniach (?)
% f0 = obj_fun(0,x0,sd,T); % wartosc funkcji celu w punkcie poczatkowym
% g = obj_fun_grad(x0); % gradient w x0
% opt.f0 = f0; % poczatkowa wrtosc do struktury opt
% opt.gradd = sd'*g; % rzut gradientu na kierunek poszukiwania (musi byc ujemny)
% opt.maxstep = 100; % maksymalny krok
% [xopt,fopt] = line_search(@obj_fun,x0,sd,opt,T);
% xopt
% fopt % wartosc funkcji po minimalizacji kierunkowej

%% Test BFGSa i line searcha (mimum tych funkcji to 2 i 3);
%BFGS([35;12], @obj_fun, @obj_fun_grad) % Sprawdzic maxstep!

%% Calkowanie wstecz - trzeba tez odkomentowac rk4 i appro - cos w tym nie dziala
% x = flipud(x); % Obrócenie x bo będziemy calkować w tym.
% psiT = [-2*x(1,1),-2*x(1,2),-2*x(1,3),-2*x(1,4),-2*x(1,5),-2*x(1,6),-1]; %poczoatkowe/koncowe psi
% [psit,psi] = appr([tn t0], x', psiT, @psi_rhs_SRV, 1);   % Czas obrocony
% psi = flipud(psi); % Obracamy do chronologicznej kolejnosci
% figure(2);
% plot(flipud(psit),psi); 


% figure(1);
% plot(tx,x);
% 
% u = fliplr(u); % Obrócenie x bo będziemy calkować w tyl.
% x00 = x(end,:)
% [tx,x] = appr([tx(end) tx(1)], u, x00, @rhs_SRV, 1);   % Czas obrocony
% 
% x = flipud(x);
% tx = flipud(tx);
% 
% figure(3);
% plot(tx,x); 

%% Test funkcji przelaczajacej
% Tau = [2,5,7,36,46; 7,10,22,37,40; 15,16,24,32,45];
% [t,u] = Tau2u(Tau);
% plot(t,u);

%% Test qi_tau
% Tau = [1:49;1:49;1:49];
% qi_tau(Tau)

%% Test qi_tau_grad
% Tau = [2,5,7,36,46; 7,10,22,37,40; 15,16,24,32,45];
% qi_tau_grad(Tau)

%% Test remove_pins
% Tau = [2,5,7,36, 36.03,46; 7,10,22,22,37,40; 15,16,16.04,24,32,45];
% remove_pins(Tau)

%% Test generate_switch
% Tau = [2,5,7,36,46; 7,10,22,37,40; 15,16,24,32,45];
% generate_switch(Tau)

